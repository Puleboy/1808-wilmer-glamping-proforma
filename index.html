<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1808 Wilmer Glamping Proforma</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .section-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            border-color: #667eea;
            outline: none;
        }

        .results-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .cashflow-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .cashflow-table th {
            background: #2c3e50;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
        }

        .cashflow-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .cashflow-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .highlight {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-weight: bold;
        }

        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #667eea;
            font-weight: bold;
            margin-left: 5px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #2c3e50;
            color: #fff;
            text-align: left;
            border-radius: 8px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.4;
            font-weight: normal;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #2c3e50 transparent transparent transparent;
        }

        @media (max-width: 768px) {
            .section-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .tooltip .tooltiptext {
                width: 200px;
                margin-left: -100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèïÔ∏è 1808 Wilmer Glamping Proforma</h1>
            <p>Comprehensive Financial Analysis & Projection Model</p>
        </div>

        <div class="content">
            <div class="instructions-section" style="background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%); color: white; border-radius: 15px; padding: 30px; margin-bottom: 30px;">
                <h2 style="margin-bottom: 20px; font-size: 1.8rem;">üìã How to Use This Tool</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h3 style="margin-bottom: 10px; color: #fff;">üéØ Purpose</h3>
                        <p style="margin-bottom: 15px; line-height: 1.6;">This tool analyzes the financial viability of a glamping resort investment. It models the complete lifecycle: acquiring land, developing the property, operating the business, and eventually selling it.</p>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 10px; color: #fff;">‚öôÔ∏è How It Works</h3>
                        <p style="margin-bottom: 15px; line-height: 1.6;">Simply adjust the input values in each section. The model automatically recalculates all projections in real-time. Start with the default values and modify them based on your specific project.</p>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 10px; color: #fff;">üìä Key Metrics</h3>
                        <p style="margin-bottom: 15px; line-height: 1.6;">Focus on IRR (target 15-25%), Cash-on-Cash return (target 8-15%), and total return. These show if the investment meets your return expectations.</p>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 10px; color: #fff;">üí° Tips</h3>
                        <p style="line-height: 1.6;">Conservative estimates are better than optimistic ones. Test different scenarios by changing occupancy rates, pricing, and construction costs to see how sensitive your returns are.</p>
                    </div>
                </div>
            </div>
            <div class="section-grid">
                <div class="section">
                    <h2>Project Basics</h2>
                    <div class="input-group">
                        <label for="units">Number of Units</label>
                        <input type="number" id="units" value="20" min="1">
                    </div>
                    <div class="input-group">
                        <label for="landSize">Land Size (Acres)</label>
                        <input type="number" id="landSize" value="50" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="holdPeriod">Hold Period (Years)</label>
                        <input type="number" id="holdPeriod" value="10" min="1" max="20">
                    </div>
                    <div class="input-group">
                        <label for="targetCapRate">Target Cap Rate (%)</label>
                        <input type="number" id="targetCapRate" value="7" step="0.1">
                    </div>
                </div>

                <div class="section">
                    <h2>Market Assumptions</h2>
                    <div class="input-group">
                        <label for="occupancyRate">Annual Occupancy Rate (%)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Percentage of nights booked per year. Industry average is 60-70%. Higher-end glamping can achieve 70-80% in good locations.</span>
                            </span>
                        </label>
                        <input type="number" id="occupancyRate" value="65" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="adr">Average Daily Rate ($)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Average price per night per unit. Varies by location, amenities, and season. Luxury glamping: $300-500+, Mid-range: $150-300.</span>
                            </span>
                        </label>
                        <input type="number" id="adr" value="350" min="0">
                    </div>
                    <div class="input-group">
                        <label for="revenueGrowth">Annual Revenue Growth (%)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Expected yearly increase in rates and revenue. Typically 2-4% to keep pace with inflation and market growth.</span>
                            </span>
                        </label>
                        <input type="number" id="revenueGrowth" value="3" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="inflationRate">Annual Inflation Rate (%)</label>
                        <input type="number" id="inflationRate" value="2.5" step="0.1">
                    </div>
                </div>

                <div class="section">
                    <h2>Development Costs</h2>
                    <div class="input-group">
                        <label for="landCost">Land Cost ($/Acre)</label>
                        <input type="number" id="landCost" value="25000" min="0">
                    </div>
                    <div class="input-group">
                        <label for="infrastructureCost">Infrastructure Cost ($)</label>
                        <input type="number" id="infrastructureCost" value="800000" min="0">
                    </div>
                    <div class="input-group">
                        <label for="unitCost">Cost per Unit ($)</label>
                        <input type="number" id="unitCost" value="75000" min="0">
                    </div>
                    <div class="input-group">
                        <label for="softCosts">Soft Costs (% of Hard Costs)</label>
                        <input type="number" id="softCosts" value="15" step="0.1">
                    </div>
                </div>

                <div class="section">
                    <h2>Operating Expenses</h2>
                    <div class="input-group">
                        <label for="operatingExpenseRatio">Operating Expenses (% of Revenue)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">All costs to run the business: staff, utilities, maintenance, marketing, insurance, supplies. Typically 40-50% of revenue for glamping.</span>
                            </span>
                        </label>
                        <input type="number" id="operatingExpenseRatio" value="45" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="managementFee">Management Fee (% of Revenue)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Fee paid to professional management company if you don't self-manage. Typically 6-12% of revenue.</span>
                            </span>
                        </label>
                        <input type="number" id="managementFee" value="8" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="capexReserve">CapEx Reserve (% of Revenue)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Money set aside for major repairs and replacements (roofs, HVAC, furniture). Typically 2-4% of revenue.</span>
                            </span>
                        </label>
                        <input type="number" id="capexReserve" value="3" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="propertyTaxRate">Property Tax Rate (%)</label>
                        <input type="number" id="propertyTaxRate" value="1.2" step="0.1">
                    </div>
                </div>

                <div class="section">
                    <h2>Construction Financing
                        <span class="tooltip">‚ÑπÔ∏è
                            <span class="tooltiptext">Short-term loan during development phase. Higher rates but interest-only payments. Pays for construction costs.</span>
                        </span>
                    </h2>
                    <div class="input-group">
                        <label for="constructionLTV">Construction LTV (%)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Loan-to-Value: Percentage of project costs the bank will lend. Construction loans typically 70-80%.</span>
                            </span>
                        </label>
                        <input type="number" id="constructionLTV" value="75" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="constructionRate">Construction Rate (%)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Interest rate on construction loan. Typically 2-4% higher than permanent rates due to higher risk.</span>
                            </span>
                        </label>
                        <input type="number" id="constructionRate" value="8.5" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="constructionPeriod">Construction Period (Months)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">How long development takes. Glamping typically 12-24 months depending on size and permits.</span>
                            </span>
                        </label>
                        <input type="number" id="constructionPeriod" value="18" min="1">
                    </div>
                    <div class="input-group">
                        <label for="constructionFee">Construction Loan Fee (%)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Upfront fee charged by lender. Typically 1-2% of loan amount.</span>
                            </span>
                        </label>
                        <input type="number" id="constructionFee" value="1.5" step="0.1">
                    </div>
                </div>

                <div class="section">
                    <h2>Permanent Financing
                        <span class="tooltip">‚ÑπÔ∏è
                            <span class="tooltiptext">Long-term mortgage that replaces construction loan once project is complete and operating.</span>
                        </span>
                    </h2>
                    <div class="input-group">
                        <label for="permLTV">Permanent LTV (%)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Long-term loan amount as % of property value. Commercial real estate typically 65-75%.</span>
                            </span>
                        </label>
                        <input type="number" id="permLTV" value="70" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="permRate">Permanent Rate (%)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Interest rate on long-term mortgage. Based on current commercial real estate rates.</span>
                            </span>
                        </label>
                        <input type="number" id="permRate" value="6.5" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="permTerm">Permanent Term (Years)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Loan length for amortization calculation. Commercial loans typically 20-30 years.</span>
                            </span>
                        </label>
                        <input type="number" id="permTerm" value="25" min="1">
                    </div>
                    <div class="input-group">
                        <label for="exitCapRate">Exit Cap Rate (%)
                            <span class="tooltip">‚ÑπÔ∏è
                                <span class="tooltiptext">Used to calculate sale price. Lower cap rates = higher values. Hospitality typically 6-9%.</span>
                            </span>
                        </label>
                        <input type="number" id="exitCapRate" value="7.5" step="0.1">
                    </div>
                </div>

                <div class="section">
                    <h2>Additional Revenue</h2>
                    <div class="input-group">
                        <label for="ancillaryRevenue">Ancillary Revenue (% of Room Revenue)</label>
                        <input type="number" id="ancillaryRevenue" value="25" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="seasonalPremium">Peak Season Premium (%)</label>
                        <input type="number" id="seasonalPremium" value="35" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="peakSeasonMonths">Peak Season Months</label>
                        <input type="number" id="peakSeasonMonths" value="4" min="0" max="12">
                    </div>
                </div>
            </div>

            <div class="results-section">
                <h2>üìä Investment Summary</h2>
                <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">üí° What These Numbers Mean:</h3>
                    <p style="line-height: 1.6; margin-bottom: 8px;"><strong>IRR (Internal Rate of Return):</strong> Your annualized return rate. Target 15-25% for real estate.</p>
                    <p style="line-height: 1.6; margin-bottom: 8px;"><strong>Cash-on-Cash:</strong> Year 1 cash return √∑ total equity invested. Target 8-15%.</p>
                    <p style="line-height: 1.6;"><strong>NOI (Net Operating Income):</strong> Revenue minus operating expenses, before debt payments.</p>
                </div>
                <div class="results-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="constructionEquity">$0</div>
                        <div class="metric-label">Construction Equity</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalEquityRequired">$0</div>
                        <div class="metric-label">Total Equity Required</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="constructionInterest">$0</div>
                        <div class="metric-label">Construction Interest</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="yearOneNOI">$0</div>
                        <div class="metric-label">Year 1 NOI</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="yearOneCashFlow">$0</div>
                        <div class="metric-label">Year 1 Cash Flow</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="projectedIRR">0%</div>
                        <div class="metric-label">Projected IRR</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="cashOnCash">0%</div>
                        <div class="metric-label">Year 1 Cash-on-Cash</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="exitValue">$0</div>
                        <div class="metric-label">Exit Value</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalReturn">$0</div>
                        <div class="metric-label">Total Return</div>
                    </div>
                </div>
            </div>

            <div class="section full-width">
                <h2>üìà 10-Year Cash Flow Projection</h2>
                <div style="overflow-x: auto;">
                    <table class="cashflow-table" id="cashflowTable">
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Gross Revenue</th>
                                <th>Operating Expenses</th>
                                <th>NOI</th>
                                <th>Debt Service</th>
                                <th>Cash Flow</th>
                                <th>Cumulative Cash Flow</th>
                            </tr>
                        </thead>
                        <tbody id="cashflowBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatPercent(rate) {
            return (rate).toFixed(1) + '%';
        }

        function calculatePMT(rate, nper, pv) {
            if (rate === 0) return -pv / nper;
            return -pv * (rate * Math.pow(1 + rate, nper)) / (Math.pow(1 + rate, nper) - 1);
        }

        function calculateNPV(rate, cashFlows) {
            let npv = 0;
            for (let i = 0; i < cashFlows.length; i++) {
                npv += cashFlows[i] / Math.pow(1 + rate, i);
            }
            return npv;
        }

        function calculateIRR(cashFlows, guess = 0.1) {
            const maxIterations = 100;
            const tolerance = 1e-6;
            
            for (let i = 0; i < maxIterations; i++) {
                const npv = calculateNPV(guess, cashFlows);
                const npv1 = calculateNPV(guess + tolerance, cashFlows);
                const derivative = (npv1 - npv) / tolerance;
                
                const newGuess = guess - npv / derivative;
                
                if (Math.abs(newGuess - guess) < tolerance) {
                    return newGuess;
                }
                
                guess = newGuess;
            }
            
            return guess;
        }

        function calculate() {
            // Get input values
            const units = parseFloat(document.getElementById('units').value) || 0;
            const landSize = parseFloat(document.getElementById('landSize').value) || 0;
            const holdPeriod = parseFloat(document.getElementById('holdPeriod').value) || 0;
            const targetCapRate = parseFloat(document.getElementById('targetCapRate').value) / 100 || 0;
            
            const occupancyRate = parseFloat(document.getElementById('occupancyRate').value) / 100 || 0;
            const adr = parseFloat(document.getElementById('adr').value) || 0;
            const revenueGrowth = parseFloat(document.getElementById('revenueGrowth').value) / 100 || 0;
            const inflationRate = parseFloat(document.getElementById('inflationRate').value) / 100 || 0;
            
            const landCost = parseFloat(document.getElementById('landCost').value) || 0;
            const infrastructureCost = parseFloat(document.getElementById('infrastructureCost').value) || 0;
            const unitCost = parseFloat(document.getElementById('unitCost').value) || 0;
            const softCosts = parseFloat(document.getElementById('softCosts').value) / 100 || 0;
            
            const operatingExpenseRatio = parseFloat(document.getElementById('operatingExpenseRatio').value) / 100 || 0;
            const managementFee = parseFloat(document.getElementById('managementFee').value) / 100 || 0;
            const capexReserve = parseFloat(document.getElementById('capexReserve').value) / 100 || 0;
            const propertyTaxRate = parseFloat(document.getElementById('propertyTaxRate').value) / 100 || 0;
            
            const constructionLTV = parseFloat(document.getElementById('constructionLTV').value) / 100 || 0;
            const constructionRate = parseFloat(document.getElementById('constructionRate').value) / 100 || 0;
            const constructionPeriod = parseFloat(document.getElementById('constructionPeriod').value) || 0;
            const constructionFee = parseFloat(document.getElementById('constructionFee').value) / 100 || 0;
            
            const permLTV = parseFloat(document.getElementById('permLTV').value) / 100 || 0;
            const permRate = parseFloat(document.getElementById('permRate').value) / 100 || 0;
            const permTerm = parseFloat(document.getElementById('permTerm').value) || 0;
            const exitCapRate = parseFloat(document.getElementById('exitCapRate').value) / 100 || 0;
            
            const ancillaryRevenue = parseFloat(document.getElementById('ancillaryRevenue').value) / 100 || 0;
            const seasonalPremium = parseFloat(document.getElementById('seasonalPremium').value) / 100 || 0;
            const peakSeasonMonths = parseFloat(document.getElementById('peakSeasonMonths').value) || 0;

            // Calculate development costs
            const totalLandCost = landSize * landCost;
            const totalUnitCost = units * unitCost;
            const hardCosts = totalLandCost + infrastructureCost + totalUnitCost;
            const totalSoftCosts = hardCosts * softCosts;
            const totalDevelopmentCost = hardCosts + totalSoftCosts;

            // Calculate construction financing
            const constructionLoanAmount = totalDevelopmentCost * constructionLTV;
            const constructionEquity = totalDevelopmentCost - constructionLoanAmount;
            const constructionInterestCost = constructionLoanAmount * constructionRate * (constructionPeriod / 12);
            const constructionLoanFee = constructionLoanAmount * constructionFee;
            const totalConstructionCosts = constructionInterestCost + constructionLoanFee;

            // Calculate total project cost including construction financing
            const totalProjectCost = totalDevelopmentCost + totalConstructionCosts;

            // Calculate permanent financing (based on stabilized value/cost)
            const permanentLoanAmount = Math.min(totalProjectCost * permLTV, constructionLoanAmount + totalConstructionCosts);
            const additionalEquityAtTakeout = Math.max(0, (constructionLoanAmount + totalConstructionCosts) - permanentLoanAmount);
            const totalEquityRequired = constructionEquity + additionalEquityAtTakeout;

            // Calculate permanent loan payments
            const monthlyPermRate = permRate / 12;
            const numberOfPermPayments = permTerm * 12;
            const monthlyDebtService = calculatePMT(monthlyPermRate, numberOfPermPayments, permanentLoanAmount);
            const annualDebtService = monthlyDebtService * 12;

            // Calculate base revenue
            const daysPerYear = 365;
            const baseRoomRevenue = units * adr * occupancyRate * daysPerYear;
            
            // Adjust for seasonality
            const offSeasonMonths = 12 - peakSeasonMonths;
            const peakSeasonRevenue = (baseRoomRevenue * peakSeasonMonths / 12) * (1 + seasonalPremium);
            const offSeasonRevenue = (baseRoomRevenue * offSeasonMonths / 12);
            const adjustedRoomRevenue = peakSeasonRevenue + offSeasonRevenue;
            
            const totalAncillaryRevenue = adjustedRoomRevenue * ancillaryRevenue;
            const yearOneGrossRevenue = adjustedRoomRevenue + totalAncillaryRevenue;

            // Calculate operating expenses
            const yearOnePropertyTaxes = totalProjectCost * propertyTaxRate;
            const yearOneOperatingExpenses = yearOneGrossRevenue * operatingExpenseRatio;
            const yearOneManagementFee = yearOneGrossRevenue * managementFee;
            const yearOneCapexReserve = yearOneGrossRevenue * capexReserve;
            
            const yearOneTotalExpenses = yearOneOperatingExpenses + yearOneManagementFee + 
                                       yearOneCapexReserve + yearOnePropertyTaxes;
            const yearOneNOI = yearOneGrossRevenue - yearOneTotalExpenses;
            const yearOneCashFlow = yearOneNOI - annualDebtService;

            // Calculate 10-year projections
            const cashFlows = [-totalEquityRequired]; // Initial investment including takeout equity
            const projectionData = [];
            let cumulativeCashFlow = 0;

            for (let year = 1; year <= holdPeriod; year++) {
                const grossRevenue = yearOneGrossRevenue * Math.pow(1 + revenueGrowth, year - 1);
                const operatingExpenses = grossRevenue * operatingExpenseRatio * Math.pow(1 + inflationRate, year - 1);
                const managementFeeYear = grossRevenue * managementFee;
                const capexReserveYear = grossRevenue * capexReserve;
                const propertyTaxesYear = yearOnePropertyTaxes * Math.pow(1 + inflationRate, year - 1);
                
                const totalExpensesYear = operatingExpenses + managementFeeYear + capexReserveYear + propertyTaxesYear;
                const noiYear = grossRevenue - totalExpensesYear;
                const cashFlowYear = noiYear - annualDebtService;
                
                cumulativeCashFlow += cashFlowYear;
                
                // Add exit value in final year
                if (year === holdPeriod) {
                    const exitNOI = noiYear;
                    const exitValue = exitNOI / exitCapRate;
                    const remainingLoanBalance = permanentLoanAmount * Math.pow(1 + permRate, year) - 
                                               (annualDebtService * (Math.pow(1 + permRate, year) - 1) / permRate);
                    const netExitProceeds = exitValue - Math.max(0, remainingLoanBalance);
                    const totalYearCashFlow = cashFlowYear + netExitProceeds;
                    cashFlows.push(totalYearCashFlow);
                    cumulativeCashFlow += netExitProceeds;
                    
                    projectionData.push({
                        year,
                        grossRevenue,
                        totalExpensesYear,
                        noiYear,
                        debtService: annualDebtService,
                        cashFlow: totalYearCashFlow,
                        cumulativeCashFlow,
                        isExitYear: true,
                        exitValue,
                        netExitProceeds
                    });
                } else {
                    cashFlows.push(cashFlowYear);
                    projectionData.push({
                        year,
                        grossRevenue,
                        totalExpensesYear,
                        noiYear,
                        debtService: annualDebtService,
                        cashFlow: cashFlowYear,
                        cumulativeCashFlow
                    });
                }
            }

            // Calculate returns
            const irr = calculateIRR(cashFlows) * 100;
            const cashOnCashReturn = (yearOneCashFlow / totalEquityRequired) * 100;
            const finalYear = projectionData[projectionData.length - 1];
            const exitValue = finalYear.exitValue || 0;
            const totalReturn = cumulativeCashFlow;

            // Update display
            document.getElementById('constructionEquity').textContent = formatCurrency(constructionEquity);
            document.getElementById('totalEquityRequired').textContent = formatCurrency(totalEquityRequired);
            document.getElementById('constructionInterest').textContent = formatCurrency(totalConstructionCosts);
            document.getElementById('yearOneNOI').textContent = formatCurrency(yearOneNOI);
            document.getElementById('yearOneCashFlow').textContent = formatCurrency(yearOneCashFlow);
            document.getElementById('projectedIRR').textContent = formatPercent(irr);
            document.getElementById('cashOnCash').textContent = formatPercent(cashOnCashReturn);
            document.getElementById('exitValue').textContent = formatCurrency(exitValue);
            document.getElementById('totalReturn').textContent = formatCurrency(totalReturn);

            // Update cash flow table
            const tbody = document.getElementById('cashflowBody');
            tbody.innerHTML = '';
            
            projectionData.forEach(data => {
                const row = tbody.insertRow();
                const cellClass = data.isExitYear ? 'highlight' : '';
                
                row.innerHTML = `
                    <td class="${cellClass}">${data.year}</td>
                    <td class="${cellClass}">${formatCurrency(data.grossRevenue)}</td>
                    <td class="${cellClass}">${formatCurrency(data.totalExpensesYear)}</td>
                    <td class="${cellClass}">${formatCurrency(data.noiYear)}</td>
                    <td class="${cellClass}">${formatCurrency(data.debtService)}</td>
                    <td class="${cellClass}">${formatCurrency(data.cashFlow)}</td>
                    <td class="${cellClass}">${formatCurrency(data.cumulativeCashFlow)}</td>
                `;
            });
        }

        // Add event listeners to all inputs
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', calculate);
            });
            
            // Initial calculation
            calculate();
        });
    </script>
</body>
</html>